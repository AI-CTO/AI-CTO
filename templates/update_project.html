{% extends "layout.html" %}

{% block title %}Update Project{% endblock %}

{% block content %}
<div id="projects-container">
    <script>
        window.onload = function() {
            fetch('/get_projects')
                .then(response => response.json()) 
                .then(data => {
                    if (data.projects) {
                        const container = document.getElementById('projects-container');
                        container.innerHTML = ""; 

                        data.projects.forEach(project => {
                            const projectDiv = document.createElement('div');
                            projectDiv.classList.add('project'); 

                            projectDiv.innerHTML = `
                                <h3>${project.description}</h3>
                                <input type="text" id="new-description-${project.id}" placeholder="Update your idea here">
                                <button onclick="updateProject(${project.id})">Update</button>
                                <p id="update-status-${project.id}" class="update-status" style="color: green; display: none;">
                                    Project updated successfully!
                                </p>
                            `;

                            container.appendChild(projectDiv);
                        });
                    } else {
                        console.error("No projects found.");
                    }
                })
                .catch(error => {
                    console.error("Error fetching projects:", error);
                    document.getElementById('projects-container').innerHTML = `
                        <p>Error loading projects. Please try again later.</p>
                    `;
                });
        };

   
    function updateProject(projectId) {
    const newDescription = document.getElementById(`new-description-${projectId}`).value;

    fetch("/process_project", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: new URLSearchParams({ id: projectId, description: newDescription })
    })
    .then(response => response.text())  
    .then(updatedHtml => {
        const tempDiv = document.createElement("div");
        tempDiv.innerHTML = updatedHtml;

        const updatedTitle = tempDiv.querySelector(`#project-title-${projectId}`);
        
        if (updatedTitle) {
            document.getElementById(`project-title-${projectId}`).innerText = updatedTitle.innerText;
        }

        const statusMessage = document.getElementById(`update-status-${projectId}`);
        statusMessage.style.display = "block";
        statusMessage.textContent = "Project updated successfully!";
        
        setTimeout(() => {
            statusMessage.style.display = "none";
        }, 3000);
    })
    .catch(error => console.error("Error updating project:", error));
}

    </script>
</div>
{% endblock %}